<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Digital Input 0 (DI0) reference clock timestamper"><title>stabilizer::hardware::input_stamper - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../static.files/rustdoc-aa0817cf.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="stabilizer" data-themes="" data-resource-suffix="" data-rustdoc-version="1.90.0 (1159e78c4 2025-09-14)" data-channel="1.90.0" data-search-js="search-fa3e91e5.js" data-settings-js="settings-5514c975.js" ><script src="../../../static.files/storage-68b7e25d.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../static.files/main-eebb9057.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-32bb7600.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../stabilizer/index.html">stabilizer</a><span class="version">0.11.0</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module input_<wbr>stamper</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#design" title="Design">Design</a></li><li><a href="#tradeoffs" title="Tradeoffs">Tradeoffs</a></li></ul><h3><a href="#structs">Module Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="../index.html">In stabilizer::<wbr>hardware</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../../index.html">stabilizer</a>::<wbr><a href="../index.html">hardware</a></div><h1>Module <span>input_stamper</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../src/stabilizer/hardware/input_stamper.rs.html#1-80">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Digital Input 0 (DI0) reference clock timestamper</p>
<p>This module provides a means of timestamping the rising edges of an external reference clock on
the DI0 with a timer value from TIM5.</p>
<h2 id="design"><a class="doc-anchor" href="#design">§</a>Design</h2>
<p>An input capture channel is configured on DI0 and fed into TIM5’s capture channel 4. TIM5 is
then run in a free-running mode with a configured tick rate (PSC) and maximum count value
(ARR). Whenever an edge on DI0 triggers, the current TIM5 counter value is captured and
recorded as a timestamp. This timestamp can be either directly read from the timer channel or
can be collected asynchronously via DMA collection.</p>
<p>To prevent silently discarding timestamps, the TIM5 input capture over-capture flag is
continually checked. Any over-capture event (which indicates an overwritten timestamp) then
triggers a panic to indicate the dropped timestamp so that design parameters can be adjusted.</p>
<h2 id="tradeoffs"><a class="doc-anchor" href="#tradeoffs">§</a>Tradeoffs</h2>
<p>It appears that DMA transfers can take a significant amount of time to disable (400ns) if they
are being prematurely stopped (such is the case here). As such, for a sample batch size of 1,
this can take up a significant amount of the total available processing time for the samples.
This module checks for any captured timestamps from the timer capture channel manually. In
this mode, the maximum input clock frequency supported is dependant on the sampling rate and
batch size.</p>
<p>This module only supports DI0 for timestamping due to trigger constraints on the DIx pins. If
timestamping is desired in DI1, a separate timer + capture channel will be necessary.</p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.InputStamper.html" title="struct stabilizer::hardware::input_stamper::InputStamper">Input<wbr>Stamper</a></dt><dd>The timestamper for DI0 reference clock inputs.</dd></dl></section></div></main></body></html>